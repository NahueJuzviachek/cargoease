{% extends "home/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/index.css' %}"/>

<div class="container my-4" style="max-width: 720px;">
  <h2 class="text-center">
    {% if object %}Editar Conductor{% else %}Agregar Conductor{% endif %}
  </h2>

  <form method="post" class="mt-4" novalidate>
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="mb-3">
      <label class="form-label">{{ form.nombreApellido.label }}</label>
      {{ form.nombreApellido }}
      {{ form.nombreApellido.errors }}
    </div>

    <div class="mb-3">
      <label class="form-label">{{ form.dni.label }}</label>
      {{ form.dni }}
      {{ form.dni.errors }}
    </div>

    <div class="mb-3">
      <label class="form-label">{{ form.vehiculo.label }}</label>
      {{ form.vehiculo }}
      <div class="form-text">Seleccione un vehículo (se mostrará Marca + Modelo).</div>
      {{ form.vehiculo.errors }}
    </div>

    <div class="mb-3">
      <label class="form-label">{{ form.dominio.label }}</label>
      {{ form.dominio }}
      <div class="form-text">Se completa automáticamente con el dominio del vehículo seleccionado.</div>
      {{ form.dominio.errors }}
    </div>

    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{% url 'conductores_list' %}">Cancelar</a>
      <button class="btn btn-success" type="submit">Guardar</button>
    </div>
  </form>
</div>

<script>
  (function() {
    const selectVehiculo = document.getElementById("id_vehiculo");
    const inputDominio = document.getElementById("id_dominio");
    const mapping = {};
    {% for item in vehiculo_dominios %}
      mapping["{{ item.id }}"] = "{{ item.dominio }}";
    {% endfor %}

    function syncDominio() {
      const vid = selectVehiculo.value;
      inputDominio.value = mapping[vid] || "";
    }

    if (selectVehiculo && inputDominio) {
      // set inicial (útil al editar)
      syncDominio();

      // actualizar cuando cambia la selección
      selectVehiculo.addEventListener("change", syncDominio);
    }
  })();
</script>
{% endblock %}
